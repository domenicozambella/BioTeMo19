\documentclass[11pt,twoside,a4paper]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[top=20mm, bottom= 15mm, left=15mm, right=15mm]{geometry}
\usepackage{amsmath}
\usepackage{dsfont}
\usepackage{calc} 
\usepackage{comment}
\usepackage{pythontex}
\newcommand{\mylabel}[1]{#1\hfill}
\renewenvironment{itemize}
  {\begin{list}{$\triangleright$}{%
   \setlength{\parskip}{0mm}
   \setlength{\topsep}{.4\baselineskip}
   \setlength{\rightmargin}{0mm}
   \setlength{\listparindent}{0mm}
   \setlength{\itemindent}{0mm}
   \setlength{\labelwidth}{2ex}
   \setlength{\itemsep}{.4\baselineskip}
   \setlength{\parsep}{0mm}
   \setlength{\partopsep}{0mm}
   \setlength{\labelsep}{1ex}
   \setlength{\leftmargin}{\labelwidth+\labelsep}
   \let\makelabel\mylabel}}{%
   \end{list}\vspace*{-1.3mm}}
\parindent0ex
\parskip1.5ex
\newcounter{quesito}
\newenvironment{question}{\addtocounter{quesito}{1}\par\textbf{Quesito \thequesito.\kern1ex}}{\vspace{0.5\parskip}}
\newenvironment{xquestion}{\bigskip\addtocounter{quesito}{1}\bigskip\bigskip\par\textbf{Quesito \thequesito.\kern1ex}}{\vspace{\parskip}}
\newenvironment{answer}{\par\textbf{Risposta\quad}}{\vspace{\parskip}}

\pagestyle{empty} 

\excludecomment{answer}

\begin{document}
\colorbox{blue!10}{\begin{minipage}{\textwidth}
Matematica e BioStatistica con Applicazioni Informatiche\\
Esercitazione in aula del 25 ottobre 2018
\end{minipage}}

\bigskip


\begin{pycode}
import random
random.seed(258466445)
\end{pycode}
%3
\begin{question}
\def\RR{{\mathds R}}
\def\dom{{\rm dom}}
\def\range{{\rm im}}
\begin{pycode}
random.seed(258466445)
from sympy import symbols, Rational, latex, log
x = symbols('x')
n =[Rational( i ) for i in random.sample([1,2,3,4,5],1) ]
f = abs(x) - abs(x + n[0])
\end{pycode}
Si consideri la funzione $\displaystyle f(x) = \py{latex(f)}$.
\begin{itemize}
\item[1.] Determinare dominio e immagine della funzione.
\item[2.] Determinare $f^{-1}(\py{latex(n[0])})$.
\end{itemize}

\begin{answer}

{\color{blue}
$\displaystyle \dom f \ =\ \RR$.} Si ha 

$$f(x) = \begin{cases} 
-\py{latex(n[0])}, \quad x \geq 0 
\cr 
- 2\, x - \py{latex(n[0])}, \quad - \py{latex(n[0])} \leq x < 0 
\cr 
\phantom{-}\py{latex(n[0])}, \quad x < -\py{latex(n[0])} \end{cases}$$ 

da cui {\color{blue} $\displaystyle \range f \ =\ [-\py{latex(n[0])}, \py{latex(n[0])}]$
\hfill Risposta 1\kern0ex}

{\color{blue}
$\displaystyle f^{-1}(\py{latex(n[0])}) = (-\infty, -\py{latex(n[0])}]$
\hfill Risposta 2\kern0ex}

\end{answer}
\end{question}


%5
\begin{question}
\def\RR{{\mathds R}}
\def\dom{{\rm dom}}
\def\range{{\rm im}}
\begin{pycode}
random.seed(258466445)
from sympy import symbols, Rational, latex
e, x = symbols('e x')
n = [Rational( i ) for i in random.sample([1,2,3,4,5],3) ]
f = log( n[1]*x+n[2] )
\end{pycode}
Si consideri la funzione $f(x) = \py{ latex(f) } $.
\begin{itemize}
\item[1.] Determinare dominio e immagine della funzione. 
\item[2.] Per quali valori si annulla la funzione $f(-x)$?
\end{itemize}
Esprimere il risultato come frazione di interi, ed eventualmente multipli di $e$.
\begin{answer}
{\color{blue}
$\displaystyle\dom f\ =\ \left(\py{latex(-n[2]/n[1])},\ +\infty\right)$
\qquad 
$\range f\ =\ \RR$
\hfill Risposta 1\kern0ex}

{\color{blue}
$\displaystyle x\ =\ \py{latex((1-n[2])/(-n[1]))}$
\hfill Risposta 2\kern0ex}

\end{answer}
\end{question}

\begin{question}
\def\Pr{{\rm Pr\,}}
\def\Ex{{\rm E\,}}
\def\Var{{\rm Var\,}}
\begin{pycode}
random.seed(258466445)
from sympy import *
x = random.sample([2,3,4,5],2)
x1 = x[0]
x2 = x[1]

p = random.sample([2,3,4,5],2)
d = random.choice(list(range(1,p[0])))
px = Rational(d,p[0])
d = random.choice(list(range(1,p[1])))
py = Rational(d,p[1])

\end{pycode}
Le v.a.\@ discrete $X$ e $Y$ sono indipendenti. La loro distribuzione di probabilità è data da 


\noindent\rlap{\kern15ex$\displaystyle\Pr(X=\py{x1}) =\py{latex(px)}$}\kern44ex   $\displaystyle\Pr(Y=1) =\py{latex(py)}$ 


\noindent\rlap{\kern15ex$\displaystyle\Pr(X=\py{x2}) =\py{latex(1-px)}$}\kern44ex $\displaystyle\Pr(Y=0) =\py{latex(1-py)}$

\begin{itemize}
\item[1.] Calcolare la distribuzione di probabilità di $X\cdot Y$
\item[2.] Calcolare $\Ex(X\cdot Y)$. 
\end{itemize}

Esprimere i numeri razionali come frazioni.
 
\begin{answer}

$\displaystyle\Pr(X\cdot Y=\py{x1})$ {\color{blue}$\displaystyle\ =\ \py{latex(px * py)}$}
\hfill 
$\displaystyle\Pr(X\cdot Y=\py{x2})$ {\color{blue}$\displaystyle\ =\ \py{latex((1-px) * py)}$}
\hfill 
$\displaystyle\Pr(X\cdot Y=0)$ {\color{blue}$\displaystyle\ =\ \py{latex(1-py)}$\hfill Risposta 1} 

$\displaystyle{\color{blue}\Ex(X\cdot Y)}\ =\ \py{x1}\cdot\Pr(X\cdot Y=\py{x1}) + \py{x2}\cdot\Pr(X\cdot Y=\py{x2})${\color{blue}$\ =\ \displaystyle\py{latex(x1 * px * py + x2 * (1-px) * py)}$\hfill Risposta 2} 

\end{answer}

\end{question}


\begin{question}
\def\Pr{{\rm Pr\,}}
\def\Ex{{\rm E\,}}
\def\Var{{\rm Var\,}}
\begin{pycode}
random.seed(258466445)
from scipy.stats import binom
irr = random.sample([4,5,6], 2)
n = 10 * random.choice([8,9,10])
p0 = random.choice([40, 50, 60])
p1 = p0-10
alpha =  random.choice([2,3,4,5])
beta =  random.choice([2,3,4,5])
k = int( n*p0/100 ) - 1
risultato1 = binom.cdf(k,n,p0/100)
risultato1 = round(risultato1, 4)
risultato2 = 1 - binom.cdf(k,n,p1/100)
risultato2 = round(risultato2, 4)
risultato3 = binom.ppf(alpha/100,n*10,p0/100)
risultato3 = int(risultato3)
risultato4 = binom.ppf(1 - beta/100, n*10, p1/100)
risultato4 = int(risultato4)
\end{pycode}
Una fabbrica produce confezioni di biglie rosse e blu. Una confezione corretta contiene $\py{irr[0]}\cdot 10^{\py{irr[1]}}$ biglie con circa il $\py{p0}\%$ di biglie rosse. 

Non è un problema se le biglie rosse eccedono il $\py{p0}\%$ ma vogliamo essere ragionevolmente sicuri che la percentuale non scenda mai sotto $\py{p1}\%$.  Stabiliamo quindi due livelli di controllo. 
Al primo controllo preleviamo $\py{n}$ biglie a caso da ogni confezione e se $\le\py{k}$ biglie sono rosse la confezione viene sottoposta a ulteriori controlli. Altrimenti viena dichiarata soddisfacente.

1. Si calcoli la probabilità che una confezione con $\py{p0}\%$ di biglie rosse venga sottoposta al secondo controllo.

2. Si calcoli la probabilità che una confezione con $\py{p1}\%$ di biglie rosse venga dichiarata soddisfacente.

Il secondo controllo comporta l'estrazione di altre biglie,  $\py{n*10}$ in totale. Se meno di $x\%$ è rosso la confezione viene scartata definitivamente, altrimenti viene dichiarata soddisfacente.

3. A quanto dovremmo fissare $x$ per non scartare al secondo controllo più del $\py{alpha}\%$ di confezioni con $\py{p0}\%$ di biglie rosse?

4. A quanto dovremmo fissare $x$ per non dichiare soddisfacente al secondo controllo più del $\py{beta}\%$ di confezioni con $\py{p1}\%$ di bigie rosse?

Si trattino tutte le estrazioni come estrazioni con \textit{reimbussolamento}.

\begin{answer}


Sebbene non sia son sia necessario, aiuta immaginare il seguente test d'ipotesi:
\begin{itemize}
\item $H_0:\ $ confezione corretta $\rightarrow$ $\py{p0}\%$ delle palline nella confezione sono rosse;
\item $H_A:\ $ confezione non corretta $\rightarrow$ $< \py{p0}\%$ delle palline nella confezione sono rosse.
\end{itemize} 
Nel primo punto si richiede che data una confezione il cui $\py{p0} \% $ delle palline sono palline rosse  venga sottoposta al secondo controllo. Quindi sotto l'ipotesi nulla vera, cioè che la confezione sia corretta, questa venga lo stesso considerate inadeguata, la probabilità richiesta da calcolare è un \textit{errore di primo tipo}

$\qquad
\alpha\ =\ P(\{{\rm confezione\ spedita\ a\ secondo\ controllo}\}\ | {\rm\ confezione\ corretta})
$

Come calcolare $\alpha$? 
\begin{itemize}
\item una confezione viene mandata al secondo controllo se su un totale di \py{n} estrazioni con reimbussolamento, vengano conteggiate un numero di palline rosse minore o uguale a $\py{k}$.
\item è necessaria una variabile aleatoria che sia in grado di conteggiare quanti successi (palline rosse) siano avvenuti in \py{n} estrazioni.
\item Sia $X\sim B(n,p)\ $, con $n=\py{k}$ e $p=0\py{p0/100}$. Quello che vogliamo calcolare è la seguente probabilità:

$\qquad
P(X\le \py{k})\ =\ P(\{\rm confezione\ spedita\ a\ secondo\ controllo\}).
$

\item per definizione una variabile aleatoria distribuita seconda una Binomiale è definita su due parametri: $n=\ $il numero di estrazioni massimo che viene fatto e $p=\ $probabilità di successo, nel nostro caso quindi l'estrazione di una pallina rossa dalla confezione intera. 
\end{itemize}
Per cui nel nostro caso avremo che $n=\py{n}\ $ e $p=\py{p0/100}\ $ in quanto la confezione è formata dal $\py{p0}\%\ $ di palline rosse. Quindi possiamo affermare che:

$\qquad\displaystyle
P(X\le \py{k})\ =\  \sum_{i=0}^{\py{k}}\binom{\py{n}}{i} p^i (1-p)^{\py{n}-i} 
$

Da notare: non è richiesto di sapere la formula ma di sapere quale e in che modo usare la funzione Python riportata in calce.

$\qquad\displaystyle
\phantom{P(X\le \py{k})}
\ =\ ${\tt {\color{blue} binom.cdf( \py{k}, \py{n}, \py{p0/100} )} = \py{risultato1}}\hfill  {\color{blue}Risposta 1}

\bigskip
Il punto 2 è molto simile al punto 1.\\ \emph{Ma in questo caso però è un errore di che tipo? Che effect-size $\delta$ stiamo prendendo in considerazione?}

\smallskip
$\qquad P(X\le \py{k})\ =\ ${\tt {\color{blue} 1 - binom.cdf( \py{k}, \py{n}, \py{p1/100} )} = \py{risultato2}}\hfill  {\color{blue}Risposta 2} \\

Per il punto 3 dobbiamo calcolare la soglia di palline rosse su \py{n*10} estrazioni, in maniera tale da non scartare più del $5\% \ $ delle confezioni corrette, e quindi con il $\py{p0}\%\ $ di palline rosse.

Il ragionamento è molto simile a sopra solo che ora conosciamo $\alpha$ e dobbiamo calcolare ilvalore di soglia (che prima era \py{k}) necessario per decidere se la confezione può essere accettata. Quindi quello che dobbiamo trovare è:

$\qquad\begin{array}{rclcl}
P(X > x )&\cong&{\tt 1-\alpha} &\cong&{\tt 1-\py{alpha/100}}\\
1-P(X \le x )&\cong&{\tt 1-\py{alpha/100}}\\
P(X \le x )&\cong&{\tt \py{alpha/100}}
\end{array}$

ma allora 

$\displaystyle\qquad
x$
\ =\ {\tt {\color{blue} binom.ppf( \py{alpha/100}, \py{n*10}, \py{p0/100} )} = \py{risultato3}}\hfill  {\color{blue}Risposta 3}

\bigskip
Il punto 4 è simile al punto 3.

$\displaystyle\qquad
x$
\ =\ {\tt {\color{blue} binom.ppf( \py{1- beta/100}, \py{n*10}, \py{p1/100} )} = \py{risultato4}}\hfill {\color{blue}Risposta 4}







\end{answer}
\end{question}



\vfill
\hrulefill

Si assuma noto il valore delle seguenti funzioni della libreria {\tt scipy.stats\/} di  {\tt Python\/}

{\tt binom.pmf(k,n,p)} = $\Pr\big(X={\tt k}\big)$ dove $X\sim B({\tt n},{\tt p})$ 

{\tt binom.cdf(k)} = $\Pr\big(X\le{\tt k}\big)$ dove  $X\sim B({\tt n},{\tt p})$ 

{\tt bimom.ppf(q, n, p)} = ${\tt k}$ dove ${\tt k}$ è tale che $\Pr\big(X\le{\tt k}\big)\cong{\tt q}$ per $X\sim B({\tt n},{\tt p})$ 







\end{document}

